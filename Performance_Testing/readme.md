# รายงานผลการทดสอบประสิทธิภาพระบบ (Performance Testing Report - K6)

เอกสารฉบับนี้สรุปผลการทดสอบด้วย K6 เพื่อประเมิน **Reliability, Scalability, Stability** ของระบบภายใต้สถานการณ์โหลดที่แตกต่างกัน พร้อมข้อสังเกตและข้อเสนอแนะสำหรับการปรับปรุงประสิทธิภาพ

---

## สารบัญ
1. [ภาพรวมการทดสอบ](#ภาพรวมการทดสอบ)
2. [รายละเอียดแต่ละ Test Scenario](#รายละเอียดแต่ละ-test-scenario)
3. [การวิเคราะห์เชิงลึก (Performance Analysis)](#การวิเคราะห์เชิงลึก-performance-analysis)
4. [สรุปและข้อเสนอแนะ](#สรุปและข้อเสนอแนะ-conclusion--recommendations)

---

## ภาพรวมการทดสอบ
ดำเนินการทดสอบ 4 รูปแบบหลัก ได้แก่ **Average-Load, Stress, Soak, Spike** เพื่อครอบคลุมพฤติกรรมระบบทั้งในสภาวะปกติ ขีดจำกัด ระยะยาว และเหตุการณ์โหลดพุ่งสูงชั่วคราว

---

## รายละเอียดแต่ละ Test Scenario

### 1. Average-Load Test (โหลดปกติ)
#### การตั้งค่าและวัตถุประสงค์
- จำลองผู้ใช้งาน (Virtual Users - VUs) จำนวน **50 คน** เป็นเวลา **5 นาที**
- วัดประสิทธิภาพระบบในสภาวะใช้งานทั่วไป ให้ค่า Response Time นิ่งเพียงพอสำหรับการเทียบเกณฑ์

#### ผลการทดสอบ
| Metric             | ค่า          |
|-------------------|--------------|
| avg               | 6.31 วินาที  |
| median            | 2.72 วินาที  |
| p(90)             | 14.30 วินาที |
| p(95)             | 15.22 วินาที |
| max               | 17.19 วินาที |
| http_req_failed   | 4.39%        |
| จำนวน request     | 2232         |

#### บทสรุป
- Avg Response Time 6.31 วินาที และ P(95) 15.22 วินาที (ไม่ผ่านเกณฑ์)
- Error Rate 4.39% พร้อมข้อความ `connection refused` บ่งชี้ว่าเริ่มรับโหลดพื้นฐานไม่ไหว

---

### 2. Stress Test (ขีดจำกัดระบบ)
#### การตั้งค่าและวัตถุประสงค์
- เพิ่ม VUs แบบไต่ระดับจาก 0 จนถึง **300 VUs** (6 เท่าของโหลดปกติ)
- ใช้เพื่อค้นหาจุดที่ระบบเริ่มล้มเหลวและวัดความสามารถในการขยาย (Scalability)

#### ผลการทดสอบ
| Metric            | ค่า         |
|-------------------|------------|
| avg               | 18.32 วินาที |
| median            | 6.20 วินาที  |
| p(90)             | 55.07 วินาที |
| p(95)             | 56.84 วินาที |
| max               | 59.91 วินาที |
| http_req_failed   | 15.91%     |
| จำนวน request     | 6634       |

#### บทสรุป
- Latency พุ่งสูงเกิน 50 วินาทีตั้งแต่ช่วงโหลดกลาง พร้อม Error Rate 15.91%
- ระบบยังไม่รองรับ 300 concurrent users อย่างมีเสถียรภาพ

![alt text](stress_result.png)

---

### 3. Soak Test (ความทนทานระยะยาว)
#### การตั้งค่าและวัตถุประสงค์
- คงระดับผู้ใช้งานไว้ที่ **50 VUs** ต่อเนื่อง เพื่อตรวจสอบปัญหา Resource Leak
- ตัดปัจจัยความหนาแน่นโหลด เพื่อโฟกัสที่การ Recovery ของ Server

#### ผลการทดสอบ
| Metric             | ค่า          |
|-------------------|--------------|
| avg               | 6.31 วินาที  |
| median            | 2.72 วินาที  |
| p(90)             | 14.30 วินาที |
| p(95)             | 15.22 วินาที |
| max               | 17.19 วินาที |
| http_req_failed   | 4.39%        |
| จำนวน request     | 2232         |

#### บทสรุป
- พบ Error `unexpected EOF` และ `connection refused` จำนวนมาก
- มีแนวโน้มเกิด Resource Leak ทำให้ระบบไม่สามารถรับคำขอใหม่ได้เมื่อรันนาน ๆ

![alt text](image.png)

---

### 4. Spike Test (โหลดพุ่งเฉียบพลัน)
#### การตั้งค่าและวัตถุประสงค์
1. **Base Load:** 50 VUs (5 นาที) เพื่อวอร์มระบบ  
2. **Spike:** เพิ่มทันทีเป็น **250 VUs** (1 นาที) เพื่อจำลอง Flash Crowd  
3. **Recovery:** ลดกลับสู่ 50 VUs (5 นาที) เพื่อดูการฟื้นตัวหลังเหตุการณ์

#### ผลการทดสอบ
| Metric | Value | Result |
|-------|-------|--------|
| Requests Total | 5007 | - |
| checks_succeeded | 43.80% (2185/4988) | ไม่ผ่าน |
| checks_failed | 56.19% (2803/4988) | ไม่ผ่าน |
| status is 200 | 83% (✓2078 / ✗416) | ไม่ผ่าน |
| response time < 1s | 4% (✓107 / ✗2387) | ไม่ผ่าน |
| http_req_failed | 8.30% (416/5007) | ไม่ผ่าน |

**Latency / Response Time**
| Metric | ค่า |
|--------|-----|
| avg | 12.29 วินาที |
| median | 3.08 วินาที |
| p(90) | 38.81 วินาที |
| p(95) | 55.15 วินาที |
| max | 59.42 วินาที |

#### บทสรุป
- P(95) 55.15 วินาที และ Recovery Stage ไม่ผ่าน (Failed)
- ระบบล่มในช่วง Spike และไม่สามารถกลับมาทำงานปกติได้เอง

![alt text](image-1.png)

---

## การวิเคราะห์เชิงลึก (Performance Analysis)

### 1. ความสามารถรองรับผู้ใช้ก่อน Response Time > 1 วินาที
- ระบบรักษา Response Time < 1 วินาทีได้ที่ประมาณ 10–20 concurrent users เท่านั้น
- ที่ 50 VUs Median อยู่ที่ **2.72 วินาที** และใน Spike Test มีเพียง **4%** ที่ต่ำกว่า 1 วินาที
- **สรุป:** ขีดจำกัดสำหรับ UX ที่ดีอยู่ราว **10-20 concurrent users**

### 2. จุดเริ่มแสดงปัญหาใน Stress Test
- ระบบเริ่มมีอาการตั้งแต่ช่วงต้น คาดว่า **ต่ำกว่า 10-20 VUs** ก็เห็น Error แล้ว

### 3. Soak Test พบ Memory/Resource Leak หรือไม่
- **มีโอกาสสูง**: มี Error `unexpected EOF` และ `connection refused` อย่างต่อเนื่อง
- สะท้อนว่าทรัพยากรถูกใช้งานจนเต็มและคืนค่าไม่ทัน หรือแอปพลิเคชันรีสตาร์ทระหว่างทดสอบ

### 4. ความสามารถในการฟื้นตัวหลัง Spike
- **Failed to Recover**: หลังลดโหลดกลับสู่ 50 VUs ระบบยังมี Error ต่อเนื่อง ต้องรีสตาร์ทเพื่อกลับมาปกติ

### 5. สิ่งที่ Metrics บอกเกี่ยวกับระบบ
- **`http_req_failed` 4.39% - 15.91%** แสดงถึง Availability ต่ำ (ส่วนใหญ่คือ Connection Refused)
- **`http_req_duration` P(95) 15 - 56 วินาที** ชี้ถึง UX ที่ไม่เหมาะกับการใช้งานจริง
- **`vus_max` ที่ 50, 250, 300** ทำให้เห็นชัดว่าระบบไม่สามารถ Scale รับโหลดที่เพิ่มขึ้นได้เลย

---

## สรุปและข้อเสนอแนะ (Conclusion & Recommendations)

- ระบบปัจจุบัน **ยังไม่พร้อมสำหรับ Production** ที่มีผู้ใช้พร้อมกันเกิน 20-30 คน

